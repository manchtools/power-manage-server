// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: identity_links.sql

package generated

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const countIdentityLinksForUser = `-- name: CountIdentityLinksForUser :one
SELECT COUNT(*) FROM identity_links_projection
WHERE user_id = $1
`

func (q *Queries) CountIdentityLinksForUser(ctx context.Context, userID string) (int64, error) {
	row := q.db.QueryRow(ctx, countIdentityLinksForUser, userID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const getIdentityLinkByID = `-- name: GetIdentityLinkByID :one
SELECT id, user_id, provider_id, external_id, external_email, external_name, linked_at, last_login_at, projection_version FROM identity_links_projection
WHERE id = $1
`

func (q *Queries) GetIdentityLinkByID(ctx context.Context, id string) (IdentityLinksProjection, error) {
	row := q.db.QueryRow(ctx, getIdentityLinkByID, id)
	var i IdentityLinksProjection
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.ProviderID,
		&i.ExternalID,
		&i.ExternalEmail,
		&i.ExternalName,
		&i.LinkedAt,
		&i.LastLoginAt,
		&i.ProjectionVersion,
	)
	return i, err
}

const getIdentityLinkByProviderAndExternalID = `-- name: GetIdentityLinkByProviderAndExternalID :one
SELECT id, user_id, provider_id, external_id, external_email, external_name, linked_at, last_login_at, projection_version FROM identity_links_projection
WHERE provider_id = $1 AND external_id = $2
`

type GetIdentityLinkByProviderAndExternalIDParams struct {
	ProviderID string `json:"provider_id"`
	ExternalID string `json:"external_id"`
}

func (q *Queries) GetIdentityLinkByProviderAndExternalID(ctx context.Context, arg GetIdentityLinkByProviderAndExternalIDParams) (IdentityLinksProjection, error) {
	row := q.db.QueryRow(ctx, getIdentityLinkByProviderAndExternalID, arg.ProviderID, arg.ExternalID)
	var i IdentityLinksProjection
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.ProviderID,
		&i.ExternalID,
		&i.ExternalEmail,
		&i.ExternalName,
		&i.LinkedAt,
		&i.LastLoginAt,
		&i.ProjectionVersion,
	)
	return i, err
}

const getIdentityLinkByProviderAndUser = `-- name: GetIdentityLinkByProviderAndUser :one
SELECT id, user_id, provider_id, external_id, external_email, external_name, linked_at, last_login_at, projection_version FROM identity_links_projection
WHERE provider_id = $1 AND user_id = $2
`

type GetIdentityLinkByProviderAndUserParams struct {
	ProviderID string `json:"provider_id"`
	UserID     string `json:"user_id"`
}

func (q *Queries) GetIdentityLinkByProviderAndUser(ctx context.Context, arg GetIdentityLinkByProviderAndUserParams) (IdentityLinksProjection, error) {
	row := q.db.QueryRow(ctx, getIdentityLinkByProviderAndUser, arg.ProviderID, arg.UserID)
	var i IdentityLinksProjection
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.ProviderID,
		&i.ExternalID,
		&i.ExternalEmail,
		&i.ExternalName,
		&i.LinkedAt,
		&i.LastLoginAt,
		&i.ProjectionVersion,
	)
	return i, err
}

const listIdentityLinksForUser = `-- name: ListIdentityLinksForUser :many
SELECT il.id, il.user_id, il.provider_id, il.external_id, il.external_email, il.external_name, il.linked_at, il.last_login_at, il.projection_version, ip.name AS provider_name, ip.slug AS provider_slug
FROM identity_links_projection il
JOIN identity_providers_projection ip ON ip.id = il.provider_id
WHERE il.user_id = $1 AND ip.is_deleted = FALSE
ORDER BY il.linked_at DESC
`

type ListIdentityLinksForUserRow struct {
	ID                string             `json:"id"`
	UserID            string             `json:"user_id"`
	ProviderID        string             `json:"provider_id"`
	ExternalID        string             `json:"external_id"`
	ExternalEmail     string             `json:"external_email"`
	ExternalName      string             `json:"external_name"`
	LinkedAt          pgtype.Timestamptz `json:"linked_at"`
	LastLoginAt       pgtype.Timestamptz `json:"last_login_at"`
	ProjectionVersion int64              `json:"projection_version"`
	ProviderName      string             `json:"provider_name"`
	ProviderSlug      string             `json:"provider_slug"`
}

func (q *Queries) ListIdentityLinksForUser(ctx context.Context, userID string) ([]ListIdentityLinksForUserRow, error) {
	rows, err := q.db.Query(ctx, listIdentityLinksForUser, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListIdentityLinksForUserRow{}
	for rows.Next() {
		var i ListIdentityLinksForUserRow
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.ProviderID,
			&i.ExternalID,
			&i.ExternalEmail,
			&i.ExternalName,
			&i.LinkedAt,
			&i.LastLoginAt,
			&i.ProjectionVersion,
			&i.ProviderName,
			&i.ProviderSlug,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listLinkedProviderIDsForUser = `-- name: ListLinkedProviderIDsForUser :many
SELECT provider_id FROM identity_links_projection
WHERE user_id = $1
`

func (q *Queries) ListLinkedProviderIDsForUser(ctx context.Context, userID string) ([]string, error) {
	rows, err := q.db.Query(ctx, listLinkedProviderIDsForUser, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []string{}
	for rows.Next() {
		var provider_id string
		if err := rows.Scan(&provider_id); err != nil {
			return nil, err
		}
		items = append(items, provider_id)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
