// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: osquery.sql

package generated

import (
	"context"
)

const completeOSQueryResult = `-- name: CompleteOSQueryResult :exec
UPDATE osquery_results
SET completed = TRUE, success = $2, error = $3, rows = $4, completed_at = NOW()
WHERE query_id = $1
`

type CompleteOSQueryResultParams struct {
	QueryID string `json:"query_id"`
	Success bool   `json:"success"`
	Error   string `json:"error"`
	Rows    []byte `json:"rows"`
}

func (q *Queries) CompleteOSQueryResult(ctx context.Context, arg CompleteOSQueryResultParams) error {
	_, err := q.db.Exec(ctx, completeOSQueryResult,
		arg.QueryID,
		arg.Success,
		arg.Error,
		arg.Rows,
	)
	return err
}

const createOSQueryResult = `-- name: CreateOSQueryResult :exec

INSERT INTO osquery_results (query_id, device_id, table_name)
VALUES ($1, $2, $3)
`

type CreateOSQueryResultParams struct {
	QueryID   string `json:"query_id"`
	DeviceID  string `json:"device_id"`
	TableName string `json:"table_name"`
}

// OSQuery on-demand result queries
func (q *Queries) CreateOSQueryResult(ctx context.Context, arg CreateOSQueryResultParams) error {
	_, err := q.db.Exec(ctx, createOSQueryResult, arg.QueryID, arg.DeviceID, arg.TableName)
	return err
}

const deleteOldOSQueryResults = `-- name: DeleteOldOSQueryResults :exec
DELETE FROM osquery_results
WHERE created_at < NOW() - INTERVAL '1 hour'
`

func (q *Queries) DeleteOldOSQueryResults(ctx context.Context) error {
	_, err := q.db.Exec(ctx, deleteOldOSQueryResults)
	return err
}

const getOSQueryResult = `-- name: GetOSQueryResult :one
SELECT query_id, device_id, table_name, completed, success, error, rows, created_at, completed_at FROM osquery_results
WHERE query_id = $1
`

func (q *Queries) GetOSQueryResult(ctx context.Context, queryID string) (OsqueryResult, error) {
	row := q.db.QueryRow(ctx, getOSQueryResult, queryID)
	var i OsqueryResult
	err := row.Scan(
		&i.QueryID,
		&i.DeviceID,
		&i.TableName,
		&i.Completed,
		&i.Success,
		&i.Error,
		&i.Rows,
		&i.CreatedAt,
		&i.CompletedAt,
	)
	return i, err
}
