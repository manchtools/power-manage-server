// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: totp.sql

package generated

import (
	"context"
)

const getTOTPByUserID = `-- name: GetTOTPByUserID :one
SELECT user_id, secret_encrypted, verified, enabled, backup_codes_hash, backup_codes_used, created_at, updated_at, projection_version FROM totp_projection WHERE user_id = $1
`

func (q *Queries) GetTOTPByUserID(ctx context.Context, userID string) (TotpProjection, error) {
	row := q.db.QueryRow(ctx, getTOTPByUserID, userID)
	var i TotpProjection
	err := row.Scan(
		&i.UserID,
		&i.SecretEncrypted,
		&i.Verified,
		&i.Enabled,
		&i.BackupCodesHash,
		&i.BackupCodesUsed,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.ProjectionVersion,
	)
	return i, err
}

const getTOTPStatus = `-- name: GetTOTPStatus :one
SELECT enabled,
       (SELECT count(*) FROM unnest(backup_codes_used) AS u WHERE u = FALSE)::int AS backup_codes_remaining
FROM totp_projection WHERE user_id = $1
`

type GetTOTPStatusRow struct {
	Enabled              bool  `json:"enabled"`
	BackupCodesRemaining int32 `json:"backup_codes_remaining"`
}

func (q *Queries) GetTOTPStatus(ctx context.Context, userID string) (GetTOTPStatusRow, error) {
	row := q.db.QueryRow(ctx, getTOTPStatus, userID)
	var i GetTOTPStatusRow
	err := row.Scan(&i.Enabled, &i.BackupCodesRemaining)
	return i, err
}

const isTOTPEnabled = `-- name: IsTOTPEnabled :one
SELECT totp_enabled FROM users_projection WHERE id = $1 AND is_deleted = FALSE
`

func (q *Queries) IsTOTPEnabled(ctx context.Context, id string) (bool, error) {
	row := q.db.QueryRow(ctx, isTOTPEnabled, id)
	var totp_enabled bool
	err := row.Scan(&totp_enabled)
	return totp_enabled, err
}
